<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Deck Lotus - MTG Deck Builder</title>
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicon-16x16.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicon-32x32.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="192x192"
            href="/android-chrome-192x192.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="512x512"
            href="/android-chrome-512x512.png"
        />
        <link rel="stylesheet" href="/mana.min.css" />
        <link
            rel="stylesheet"
            type="text/css"
            href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css"
        />
        <link
            rel="stylesheet"
            type="text/css"
            href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"
        />
        <link rel="stylesheet" href="/src/styles/main.css" />
    </head>
    <body>
        <div id="app">
            <!-- Navigation -->
            <nav id="navbar" class="navbar hidden">
                <div class="nav-container">
                    <div class="nav-brand">
                        <img
                            src="/decklotus.png"
                            alt="Deck Lotus"
                            style="height: 40px"
                        />
                    </div>
                    <div class="nav-links">
                        <a href="#" data-page="decks" class="nav-link active">
                            <i class="ph ph-cards nav-icon"></i>
                            <span class="nav-text">My Decks</span>
                        </a>
                        <a href="#" data-page="cards" class="nav-link">
                            <i class="ph ph-magnifying-glass nav-icon"></i>
                            <span class="nav-text">Browse Cards</span>
                        </a>
                        <a href="#" data-page="shopping" class="nav-link">
                            <i class="ph ph-shopping-cart nav-icon"></i>
                            <span class="nav-text">Shopping</span>
                        </a>
                        <a href="#" data-page="settings" class="nav-link">
                            <i class="ph ph-gear nav-icon"></i>
                            <span class="nav-text">Settings</span>
                        </a>
                        <div class="user-menu">
                            <button
                                id="user-avatar-btn"
                                class="user-avatar-btn"
                            >
                                <img
                                    id="user-avatar-img"
                                    src=""
                                    alt="User avatar"
                                    class="user-avatar-img hidden"
                                />
                                <div
                                    id="user-avatar-initials"
                                    class="user-avatar-initials"
                                ></div>
                            </button>
                            <div
                                id="user-dropdown"
                                class="user-dropdown hidden"
                            >
                                <div class="user-dropdown-header">
                                    <div class="user-dropdown-avatar">
                                        <img
                                            id="dropdown-avatar-img"
                                            src=""
                                            alt="User avatar"
                                            class="dropdown-avatar-img hidden"
                                        />
                                        <div
                                            id="dropdown-avatar-initials"
                                            class="dropdown-avatar-initials"
                                        ></div>
                                    </div>
                                    <div class="user-dropdown-info">
                                        <div
                                            id="dropdown-username"
                                            class="dropdown-username"
                                        ></div>
                                        <div
                                            id="dropdown-email"
                                            class="dropdown-email"
                                        ></div>
                                    </div>
                                </div>
                                <div class="user-dropdown-divider"></div>
                                <div class="user-dropdown-stats">
                                    <div class="stat-item">
                                        <i class="ph ph-cards"></i>
                                        <div class="stat-content">
                                            <span
                                                id="stat-decks"
                                                class="stat-value"
                                                >0</span
                                            >
                                            <span class="stat-label"
                                                >Decks</span
                                            >
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <i class="ph ph-stack"></i>
                                        <div class="stat-content">
                                            <span
                                                id="stat-cards"
                                                class="stat-value"
                                                >0</span
                                            >
                                            <span class="stat-label"
                                                >Cards</span
                                            >
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <i class="ph ph-key"></i>
                                        <div class="stat-content">
                                            <span
                                                id="stat-api-keys"
                                                class="stat-value"
                                                >0</span
                                            >
                                            <span class="stat-label"
                                                >API Keys</span
                                            >
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <i class="ph ph-share-network"></i>
                                        <div class="stat-content">
                                            <span
                                                id="stat-shared"
                                                class="stat-value"
                                                >0</span
                                            >
                                            <span class="stat-label"
                                                >Shared</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="user-dropdown-divider"></div>
                                <button
                                    id="logout-btn"
                                    class="user-dropdown-logout"
                                >
                                    <i class="ph ph-sign-out"></i>
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Auth Page -->
            <div id="auth-page" class="page active">
                <div class="auth-container">
                    <div class="auth-card">
                        <img
                            src="/decklotus.png"
                            alt="Deck Lotus"
                            class="auth-logo"
                        />
                        <p class="auth-subtitle">
                            Build your MTG decks with style
                        </p>

                        <!-- Login Form -->
                        <div id="login-form" class="auth-form">
                            <h2>Login</h2>
                            <form id="login-form-element">
                                <div class="form-group">
                                    <label for="login-username"
                                        >Username or Email</label
                                    >
                                    <input
                                        type="text"
                                        id="login-username"
                                        required
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="login-password">Password</label>
                                    <input
                                        type="password"
                                        id="login-password"
                                        required
                                    />
                                </div>
                                <button
                                    type="submit"
                                    class="btn btn-primary btn-block"
                                >
                                    Login
                                </button>
                                <p class="auth-switch">
                                    Don't have an account?
                                    <a href="#" id="show-register">Register</a>
                                </p>
                            </form>
                        </div>

                        <!-- Register Form -->
                        <div id="register-form" class="auth-form hidden">
                            <h2>Register</h2>
                            <form id="register-form-element">
                                <div class="form-group">
                                    <label for="register-username"
                                        >Username</label
                                    >
                                    <input
                                        type="text"
                                        id="register-username"
                                        required
                                        minlength="3"
                                        maxlength="20"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="register-email">Email</label>
                                    <input
                                        type="email"
                                        id="register-email"
                                        required
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="register-password"
                                        >Password</label
                                    >
                                    <input
                                        type="password"
                                        id="register-password"
                                        required
                                        minlength="8"
                                    />
                                </div>
                                <button
                                    type="submit"
                                    class="btn btn-primary btn-block"
                                >
                                    Register
                                </button>
                                <p class="auth-switch">
                                    Already have an account?
                                    <a href="#" id="show-login">Login</a>
                                </p>
                            </form>
                        </div>

                        <div id="auth-error" class="error-message hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Decks Page -->
            <div id="decks-page" class="page hidden">
                <div class="page-header">
                    <h2>My Decks</h2>
                    <div style="display: flex; gap: 0.5rem">
                        <button id="import-deck-btn" class="btn btn-secondary">
                            <i class="ph ph-upload btn-icon"></i>
                            <span class="btn-text">Import Deck</span>
                        </button>
                        <button id="new-deck-btn" class="btn btn-primary">
                            <i class="ph ph-plus btn-icon"></i>
                            <span class="btn-text">New Deck</span>
                        </button>
                    </div>
                </div>
                <div id="decks-list" class="decks-grid"></div>
            </div>

            <!-- Deck Builder Page -->
            <div id="deck-builder-page" class="page hidden">
                <div class="deck-builder">
                    <div class="deck-header">
                        <div class="deck-info-row">
                            <input
                                type="text"
                                id="deck-name"
                                class="deck-name-input"
                                placeholder="Deck Name"
                            />
                            <select id="deck-format" class="deck-format-select">
                                <option value="">Select Format</option>
                                <option value="standard">Standard</option>
                                <option value="modern">Modern</option>
                                <option value="commander">Commander</option>
                                <option value="legacy">Legacy</option>
                                <option value="vintage">Vintage</option>
                                <option value="pauper">Pauper</option>
                            </select>
                            <div class="deck-actions">
                                <button
                                    id="share-deck-btn"
                                    class="btn btn-secondary"
                                >
                                    Share
                                </button>
                                <button
                                    id="save-deck-btn"
                                    class="btn btn-primary"
                                >
                                    Save
                                </button>
                                <button
                                    id="back-to-decks-btn"
                                    class="btn btn-secondary"
                                >
                                    Back
                                </button>
                            </div>
                        </div>
                        <div class="deck-price-row">
                            <div
                                id="deck-total-price"
                                class="deck-price-display"
                            ></div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button id="optimize-printings-btn" class="btn btn-secondary">
                                    <i class="ph ph-magic-wand btn-icon"></i>
                                    <span class="btn-text">Optimize Printings</span>
                                </button>
                                <button id="buy-deck-btn" class="btn btn-success">
                                    Buy Deck
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Card Search - Full Width Row -->
                    <div class="search-panel-row">
                        <div class="search-box">
                            <input
                                type="text"
                                id="card-search"
                                placeholder="Add new cards..."
                                autocomplete="off"
                            />
                            <div
                                id="search-results"
                                class="search-results hidden"
                            ></div>
                        </div>
                    </div>

                    <div class="deck-builder-content">
                        <!-- Deck List -->
                        <div class="deck-panel">
                            <div class="deck-tabs">
                                <button
                                    class="tab-btn active"
                                    data-tab="mainboard"
                                >
                                    Mainboard (<span id="mainboard-count"
                                        >0</span
                                    >)
                                </button>
                                <button class="tab-btn" data-tab="sideboard">
                                    Sideboard (<span id="sideboard-count"
                                        >0</span
                                    >)
                                </button>
                                <button class="tab-btn" data-tab="maybeboard">
                                    Maybeboard (<span id="maybeboard-count"
                                        >0</span
                                    >)
                                </button>
                                <div class="deck-view-controls">
                                    <button
                                        id="toggle-compact-btn"
                                        class="btn-icon"
                                        title="Toggle compact view"
                                    >
                                        <i class="ph ph-list"></i>
                                    </button>
                                    <button
                                        id="export-deck-btn"
                                        class="btn-icon"
                                        title="Export deck"
                                    >
                                        <i class="ph ph-download-simple"></i>
                                    </button>
                                </div>
                            </div>
                            <div style="padding: 0.75rem; position: relative;">
                                <input
                                    type="text"
                                    id="deck-filter-search"
                                    placeholder="Filter cards in deck..."
                                    autocomplete="off"
                                    style="width: 100%; padding: 0.5rem 2rem 0.5rem 0.75rem; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); font-size: 0.9rem;"
                                />
                                <button
                                    id="deck-filter-clear"
                                    class="hidden"
                                    style="position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 0.25rem; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;"
                                    title="Clear filter"
                                >
                                    <i class="ph ph-x"></i>
                                </button>
                            </div>
                            <div id="mainboard" class="deck-list active"></div>
                            <div id="sideboard" class="deck-list hidden"></div>
                            <div id="maybeboard" class="deck-list hidden"></div>
                        </div>

                        <!-- Stats Panel -->
                        <div class="stats-panel">
                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    margin-bottom: 1rem;
                                "
                            >
                                <h3 style="margin: 0">Deck Statistics</h3>
                                <button
                                    id="check-legality-btn"
                                    class="btn btn-primary btn-sm"
                                >
                                    Check Legality
                                </button>
                            </div>
                            <div id="deck-stats">
                                <div class="stat-section">
                                    <h4>Mana Curve</h4>
                                    <div id="mana-curve" class="chart"></div>
                                </div>
                                <div class="stat-section">
                                    <h4>Card Types</h4>
                                    <div
                                        id="type-distribution"
                                        class="chart"
                                    ></div>
                                </div>
                                <div class="stat-section">
                                    <h4>Colors</h4>
                                    <div
                                        id="color-distribution"
                                        class="chart"
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Example Hand Section -->
                    <div
                        class="example-hand-section"
                        style="
                            background: var(--bg-secondary);
                            border-radius: 1rem;
                            padding: 1.5rem;
                            margin-top: 1.5rem;
                        "
                    >
                        <h3 style="margin-bottom: 1rem">Example Hand</h3>
                        <div id="example-hand" class="example-hand-grid"></div>
                        <div
                            class="example-hand-controls"
                            style="display: flex; gap: 0.5rem; margin-top: 1rem"
                        >
                            <button
                                id="draw-card-btn"
                                class="btn btn-secondary"
                                style="flex: 1"
                            >
                                <i class="ph ph-plus"></i> Draw
                            </button>
                            <button
                                id="deal-hand-btn"
                                class="btn btn-primary"
                                style="flex: 1"
                            >
                                <i class="ph ph-shuffle"></i> Deal New Hand
                            </button>
                        </div>
                        <div
                            id="hand-stats"
                            style="
                                margin-top: 1rem;
                                padding: 0.75rem;
                                background: var(--bg-tertiary);
                                border-radius: 0.5rem;
                                text-align: center;
                                font-size: 0.875rem;
                                color: var(--text-secondary);
                            "
                        ></div>
                    </div>
                </div>
            </div>

            <!-- Cards Browse Page -->
            <div id="cards-page" class="page hidden">
                <div class="page-header">
                    <h2>Browse Cards</h2>
                </div>
                <div class="cards-search" style="position: relative;">
                    <input
                        type="text"
                        id="cards-browse-search"
                        placeholder="Search cards..."
                        class="search-input"
                        style="padding-right: 2.5rem;"
                    />
                    <button
                        id="cards-browse-clear"
                        class="hidden"
                        style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 0.25rem; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;"
                        title="Clear search"
                    >
                        <i class="ph ph-x"></i>
                    </button>
                    <div
                        class="filters"
                        style="
                            display: flex;
                            gap: 1rem;
                            margin-top: 1rem;
                            flex-wrap: wrap;
                        "
                    >
                        <div>
                            <label
                                style="
                                    display: block;
                                    margin-bottom: 0.5rem;
                                    font-weight: 600;
                                "
                                >Sort By</label
                            >
                            <select
                                id="filter-sort"
                                class="filter-select"
                                style="
                                    padding: 0.5rem;
                                    border-radius: 6px;
                                    border: 1px solid var(--border-color);
                                    background: var(--bg-secondary);
                                "
                            >
                                <option value="random">Random</option>
                                <option value="name">Alphabetical</option>
                                <option value="cmc">Mana Value</option>
                                <option value="color">Color</option>
                                <option value="price">
                                    Price (High to Low)
                                </option>
                            </select>
                        </div>
                        <div>
                            <label
                                style="
                                    display: block;
                                    margin-bottom: 0.5rem;
                                    font-weight: 600;
                                "
                                >Card Type</label
                            >
                            <select
                                id="filter-types"
                                class="filter-select"
                                style="
                                    padding: 0.5rem;
                                    border-radius: 6px;
                                    border: 1px solid var(--border-color);
                                    background: var(--bg-secondary);
                                "
                            >
                                <option value="all">All Types</option>
                                <option value="Creature">Creature</option>
                                <option value="Instant">Instant</option>
                                <option value="Sorcery">Sorcery</option>
                                <option value="Enchantment">Enchantment</option>
                                <option value="Artifact">Artifact</option>
                                <option value="Planeswalker">
                                    Planeswalker
                                </option>
                                <option value="Land">Land</option>
                            </select>
                        </div>
                        <div>
                            <label
                                style="
                                    display: block;
                                    margin-bottom: 0.5rem;
                                    font-weight: 600;
                                "
                                >CMC</label
                            >
                            <div
                                style="
                                    display: flex;
                                    gap: 0.5rem;
                                    align-items: center;
                                "
                            >
                                <input
                                    type="number"
                                    id="filter-cmc-min"
                                    placeholder="Min"
                                    min="0"
                                    max="20"
                                    style="
                                        width: 70px;
                                        padding: 0.5rem;
                                        border-radius: 6px;
                                        border: 1px solid var(--border-color);
                                        background: var(--bg-secondary);
                                    "
                                />
                                <span>-</span>
                                <input
                                    type="number"
                                    id="filter-cmc-max"
                                    placeholder="Max"
                                    min="0"
                                    max="20"
                                    style="
                                        width: 70px;
                                        padding: 0.5rem;
                                        border-radius: 6px;
                                        border: 1px solid var(--border-color);
                                        background: var(--bg-secondary);
                                    "
                                />
                            </div>
                        </div>
                        <div>
                            <label
                                style="
                                    display: block;
                                    margin-bottom: 0.5rem;
                                    font-weight: 600;
                                "
                                >Colors</label
                            >
                            <div id="filter-colors" class="color-filter-group">
                                <label class="color-checkbox">
                                    <input type="checkbox" value="W" />
                                    <span class="color-checkbox-box"
                                        ><i class="ms ms-w ms-cost"></i
                                    ></span>
                                </label>
                                <label class="color-checkbox">
                                    <input type="checkbox" value="U" />
                                    <span class="color-checkbox-box"
                                        ><i class="ms ms-u ms-cost"></i
                                    ></span>
                                </label>
                                <label class="color-checkbox">
                                    <input type="checkbox" value="B" />
                                    <span class="color-checkbox-box"
                                        ><i class="ms ms-b ms-cost"></i
                                    ></span>
                                </label>
                                <label class="color-checkbox">
                                    <input type="checkbox" value="R" />
                                    <span class="color-checkbox-box"
                                        ><i class="ms ms-r ms-cost"></i
                                    ></span>
                                </label>
                                <label class="color-checkbox">
                                    <input type="checkbox" value="G" />
                                    <span class="color-checkbox-box"
                                        ><i class="ms ms-g ms-cost"></i
                                    ></span>
                                </label>
                                <label class="color-checkbox">
                                    <input type="checkbox" value="C" />
                                    <span class="color-checkbox-box"
                                        ><i class="ms ms-c ms-cost"></i
                                    ></span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label
                                style="
                                    display: block;
                                    margin-bottom: 0.5rem;
                                    font-weight: 600;
                                "
                                >Sets</label
                            >
                            <button
                                id="filter-sets-btn"
                                class="btn btn-secondary"
                                style="padding: 0.5rem 1rem"
                            >
                                <span id="selected-sets-count">All Sets</span>
                            </button>
                        </div>
                        <div>
                            <label
                                style="
                                    display: block;
                                    margin-bottom: 0.5rem;
                                    font-weight: 600;
                                "
                                >Subtypes</label
                            >
                            <button
                                id="filter-subtypes-btn"
                                class="btn btn-secondary"
                                style="padding: 0.5rem 1rem"
                            >
                                <span id="selected-subtypes-count">All Subtypes</span>
                            </button>
                        </div>
                        <div>
                            <label
                                style="
                                    display: block;
                                    margin-bottom: 0.5rem;
                                    font-weight: 600;
                                "
                                >Collection</label
                            >
                            <label class="color-checkbox">
                                <input
                                    type="checkbox"
                                    id="filter-owned"
                                    value="owned"
                                />
                                <span
                                    class="color-checkbox-box"
                                    style="
                                        padding: 0.5rem 1rem;
                                        min-width: auto;
                                    "
                                >
                                    <i class="ph ph-check-square"></i>
                                    <span style="margin-left: 0.25rem"
                                        >Owned Only</span
                                    >
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
                <div id="cards-grid" class="cards-grid"></div>
                <div
                    id="pagination"
                    class="pagination"
                    style="
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        gap: 1rem;
                        margin: 2rem 0;
                        padding: 1rem;
                    "
                >
                    <button id="prev-page" class="btn btn-secondary" disabled>
                        Previous
                    </button>
                    <span id="page-info" style="font-weight: 600"
                        >Page 1 of 1</span
                    >
                    <button id="next-page" class="btn btn-secondary" disabled>
                        Next
                    </button>
                </div>
            </div>

            <!-- Shopping Page -->
            <div id="shopping-page" class="page hidden">
                <div class="page-header">
                    <h2>Shopping List</h2>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">Find cards you need from your decks, organized by set for easy LGS shopping</p>
                </div>

                <div class="shopping-content">
                    <!-- Deck Selection -->
                    <div class="shopping-section">
                        <h3 style="margin-bottom: 1rem;">Select Decks to Shop For</h3>
                        <div id="shopping-deck-selector"></div>
                    </div>

                    <!-- Filters -->
                    <div class="shopping-section">
                        <h3 style="margin-bottom: 1rem;">Filters & Sorting</h3>
                        <div id="shopping-filters"></div>
                    </div>

                    <!-- Statistics -->
                    <div id="shopping-stats" class="shopping-stats"></div>

                    <!-- Shopping List by Set -->
                    <div class="shopping-section">
                        <div id="shopping-list-container"></div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page hidden">
                <div class="page-header">
                    <h2>Settings</h2>
                </div>
                <div class="settings-content">
                    <section id="database-section" class="settings-section">
                        <h3>Database</h3>
                        <p>
                            Refresh card database, pricing, and sets from
                            MTGJSON (runs Sunday at 3 AM automatically)
                        </p>
                        <button id="refresh-db-btn" class="btn btn-primary">
                            Refresh Database Now
                        </button>
                        <div
                            id="sync-status"
                            style="
                                margin-top: 1rem;
                                color: var(--text-secondary);
                            "
                        ></div>
                    </section>

                    <section class="settings-section" style="margin-top: 2rem">
                        <h3>API Keys</h3>
                        <p>Generate API keys for external integrations</p>
                        <button
                            id="generate-api-key-btn"
                            class="btn btn-primary"
                        >
                            Generate New API Key
                        </button>
                        <div id="api-keys-list" class="api-keys-list"></div>
                    </section>

                    <section
                        id="backup-section"
                        class="settings-section"
                        style="margin-top: 2rem"
                    >
                        <h3>Backup & Restore</h3>
                        <p>
                            Backup your user data (decks, API keys, etc.) and
                            restore from a previous backup
                        </p>
                        <p
                            style="
                                font-size: 0.875rem;
                                color: var(--text-secondary);
                                margin-top: 0.5rem;
                            "
                        >
                            Backups include all your decks, deck cards, API
                            keys, and settings. They do NOT include the card
                            database (MTGJSON data).
                        </p>

                        <!-- Quick Backup Actions -->
                        <div
                            style="display: flex; gap: 0.5rem; margin-top: 1rem"
                        >
                            <button
                                id="backup-data-btn"
                                class="btn btn-primary"
                            >
                                Download Backup
                            </button>
                            <button
                                id="restore-data-btn"
                                class="btn btn-secondary"
                            >
                                Restore from Backup
                            </button>
                            <button
                                id="create-backup-now-btn"
                                class="btn btn-secondary"
                            >
                                Create Backup Now
                            </button>
                        </div>
                        <input
                            type="file"
                            id="restore-file-input"
                            accept=".json"
                            style="display: none"
                        />

                        <!-- Backup Schedule Configuration -->
                        <div style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 8px;">
                            <h4 style="margin-bottom: 1rem;">Automatic Backup Schedule</h4>
                            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 1rem;">
                                Automatically create backups on a schedule. Backups are saved to the server and can be restored below.
                            </p>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; user-select: none;">
                                        <input type="checkbox" id="backup-schedule-enabled" style="width: 18px; height: 18px; cursor: pointer;">
                                        <span style="font-weight: 600;">Enable Automatic Backups</span>
                                    </label>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Frequency</label>
                                    <select id="backup-frequency" style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary);">
                                        <option value="6hours">Every 6 Hours</option>
                                        <option value="12hours">Every 12 Hours</option>
                                        <option value="daily" selected>Daily (2 AM)</option>
                                        <option value="weekly">Weekly (Sunday 2 AM)</option>
                                    </select>
                                </div>
                            </div>

                            <div style="margin-bottom: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Keep Last N Backups</label>
                                <input
                                    type="number"
                                    id="backup-retain-count"
                                    min="1"
                                    max="100"
                                    value="10"
                                    style="width: 150px; padding: 0.5rem; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary);"
                                />
                                <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                    Older backups will be automatically deleted
                                </p>
                            </div>

                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div id="backup-last-run" style="font-size: 0.875rem; color: var(--text-secondary);">
                                    Last backup: Never
                                </div>
                                <button id="save-backup-config-btn" class="btn btn-primary">
                                    Save Settings
                                </button>
                            </div>
                        </div>

                        <!-- Available Backups List -->
                        <div style="margin-top: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4>Available Backups</h4>
                                <button id="refresh-backups-btn" class="btn btn-secondary btn-sm">
                                    <i class="ph ph-arrows-clockwise"></i> Refresh
                                </button>
                            </div>
                            <div id="backups-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <!-- Backups will be populated here -->
                            </div>
                        </div>
                    </section>

                    <section
                        id="user-management-section"
                        class="settings-section"
                        style="margin-top: 2rem; display: none"
                    >
                        <h3>User Management</h3>
                        <p>
                            Manage all users, promote/demote admins, and delete
                            accounts
                        </p>
                        <div id="users-list" style="margin-top: 1rem"></div>
                    </section>
                </div>
            </div>

            <!-- Modal -->
            <div id="modal" class="modal hidden">
                <div class="modal-content">
                    <span class="modal-close">&times;</span>
                    <div id="modal-body"></div>
                </div>
            </div>

            <!-- Buy Deck Modal -->
            <div id="buy-deck-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="modal-close" id="buy-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1.5rem">Buy Deck</h2>
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="copy-non-owned-only" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-weight: 600;">Copy only non-owned cards</span>
                        </label>
                        <p style="margin: 0.5rem 0 0 1.75rem; font-size: 0.875rem; color: var(--text-secondary);">
                            When enabled, only cards you don't own will be copied to clipboard
                        </p>
                    </div>
                    <div class="buy-options">
                        <div class="buy-option" id="buy-tcgplayer">
                            <div class="buy-option-header">
                                <h3>TCGplayer Mass Entry</h3>
                                <span class="buy-option-badge"
                                    >Recommended</span
                                >
                            </div>
                            <p>
                                Import your deck to TCGplayer with set codes for
                                accurate pricing
                            </p>
                            <button class="btn btn-primary btn-block">
                                Open in TCGplayer
                            </button>
                        </div>
                        <div class="buy-option" id="buy-manapool">
                            <div class="buy-option-header">
                                <h3>Manapool Mass Entry</h3>
                            </div>
                            <p>
                                Import your deck to Manapool with set codes for
                                accurate pricing
                            </p>
                            <button class="btn btn-primary btn-block">
                                Open in Manapool
                            </button>
                        </div>
                        <div class="buy-option">
                            <div class="buy-option-header">
                                <h3>Copy Deck List</h3>
                            </div>
                            <p>
                                Copy formatted deck list with set codes to paste
                                manually
                            </p>
                            <button
                                class="btn btn-secondary btn-block"
                                id="copy-decklist"
                            >
                                Copy to Clipboard
                            </button>
                        </div>
                    </div>
                    <div id="decklist-preview" class="decklist-preview hidden">
                        <h4>Deck List Preview:</h4>
                        <textarea
                            id="decklist-text"
                            readonly
                            style="
                                width: 100%;
                                min-height: 200px;
                                padding: 1rem;
                                background: var(--bg-tertiary);
                                border: 1px solid var(--border);
                                border-radius: 0.5rem;
                                color: var(--text);
                                font-family: monospace;
                                font-size: 0.875rem;
                                margin-top: 0.5rem;
                            "
                        ></textarea>
                    </div>
                </div>
            </div>

            <!-- Export Deck Modal -->
            <div id="export-deck-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="modal-close" id="export-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1.5rem">Export Deck</h2>
                    <div class="export-options">
                        <button
                            class="export-format-btn"
                            data-format="moxfield"
                        >
                            <h3>Moxfield</h3>
                            <p>Format: 1 Card Name (SET) #</p>
                        </button>
                        <button class="export-format-btn" data-format="arena">
                            <h3>Arena</h3>
                            <p>Format: 1 Card Name</p>
                        </button>
                        <button class="export-format-btn" data-format="mtgo">
                            <h3>MTGO</h3>
                            <p>Format: 1 Card Name</p>
                        </button>
                        <button class="export-format-btn" data-format="text">
                            <h3>Plain Text</h3>
                            <p>Format: 1 Card Name</p>
                        </button>
                    </div>
                    <div id="export-preview" class="export-preview hidden">
                        <div
                            style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                margin-bottom: 0.5rem;
                            "
                        >
                            <h4>Deck List:</h4>
                            <button
                                class="btn btn-primary btn-sm"
                                id="copy-export"
                            >
                                Copy to Clipboard
                            </button>
                        </div>
                        <textarea
                            id="export-text"
                            readonly
                            style="
                                width: 100%;
                                min-height: 300px;
                                padding: 1rem;
                                background: var(--bg-tertiary);
                                border: 1px solid var(--border);
                                border-radius: 0.5rem;
                                color: var(--text);
                                font-family: monospace;
                                font-size: 0.875rem;
                            "
                        ></textarea>
                    </div>
                </div>
            </div>

            <!-- Card Preview (hover) -->
            <div id="card-preview" class="card-preview hidden">
                <img id="card-preview-img" src="" alt="Card preview" />
            </div>

            <!-- Import Deck Modal -->
            <div id="import-deck-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="modal-close" id="import-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1.5rem">Import Deck</h2>
                    <form id="import-deck-form">
                        <div class="form-group">
                            <label for="import-deck-name">Deck Name</label>
                            <input type="text" id="import-deck-name" required />
                        </div>
                        <div class="form-group">
                            <label for="import-deck-format"
                                >Format (Optional)</label
                            >
                            <select id="import-deck-format">
                                <option value="">Select Format</option>
                                <option value="standard">Standard</option>
                                <option value="modern">Modern</option>
                                <option value="commander">Commander</option>
                                <option value="legacy">Legacy</option>
                                <option value="vintage">Vintage</option>
                                <option value="pauper">Pauper</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="import-deck-list">Deck List</label>
                            <p
                                style="
                                    font-size: 0.875rem;
                                    color: var(--text-secondary);
                                    margin-bottom: 0.5rem;
                                "
                            >
                                Supports Moxfield, Arena, MTGO, and plain text
                                formats
                            </p>
                            <textarea
                                id="import-deck-list"
                                rows="15"
                                placeholder="Paste your deck list here...&#10;&#10;Examples:&#10;1 Lightning Bolt&#10;4 Counterspell [DMR]&#10;1 Black Lotus (LEA) 4 *F*"
                                required
                                style="
                                    font-family: monospace;
                                    font-size: 0.875rem;
                                "
                            ></textarea>
                        </div>
                        <div style="display: flex; gap: 0.5rem">
                            <button
                                type="submit"
                                class="btn btn-primary"
                                style="flex: 1"
                            >
                                Import Deck
                            </button>
                            <button
                                type="button"
                                class="btn btn-secondary"
                                id="cancel-import"
                            >
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Share Deck Modal -->
            <div id="share-deck-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="modal-close" id="share-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1.5rem">Share Deck</h2>
                    <p
                        style="
                            margin-bottom: 1rem;
                            color: var(--text-secondary);
                        "
                    >
                        Anyone with this link can view this deck (read-only)
                    </p>
                    <div class="form-group">
                        <label>Share Link</label>
                        <div style="display: flex; gap: 0.5rem">
                            <input
                                type="text"
                                id="share-link-input"
                                readonly
                                style="flex: 1"
                            />
                            <button
                                class="btn btn-primary"
                                id="copy-share-link"
                            >
                                Copy Link
                            </button>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem">
                        <button
                            class="btn btn-secondary"
                            id="delete-share-link"
                        >
                            Delete Share Link
                        </button>
                    </div>
                </div>
            </div>

            <!-- Shared Deck View Page (Public) -->
            <div id="shared-deck-page" class="page hidden">
                <div class="deck-builder">
                    <div class="deck-header">
                        <div class="deck-info-row">
                            <h2 id="shared-deck-name" style="margin: 0"></h2>
                            <span
                                id="shared-deck-format"
                                class="badge"
                                style="margin-left: 1rem"
                            ></span>
                            <div class="deck-actions" style="margin-left: auto">
                                <button
                                    id="import-shared-deck-btn"
                                    class="btn btn-primary hidden"
                                >
                                    Import to My Decks
                                </button>
                                <button
                                    id="login-to-import-btn"
                                    class="btn btn-primary hidden"
                                >
                                    Login to Import
                                </button>
                            </div>
                        </div>
                        <p
                            id="shared-deck-description"
                            style="
                                color: var(--text-secondary);
                                margin-top: 0.5rem;
                            "
                        ></p>
                    </div>

                    <div class="deck-builder-content">
                        <!-- Deck List -->
                        <div class="deck-panel">
                            <div class="deck-tabs">
                                <button
                                    class="tab-btn active"
                                    data-tab="shared-mainboard"
                                >
                                    Mainboard (<span id="shared-mainboard-count"
                                        >0</span
                                    >)
                                </button>
                                <button
                                    class="tab-btn"
                                    data-tab="shared-sideboard"
                                >
                                    Sideboard (<span id="shared-sideboard-count"
                                        >0</span
                                    >)
                                </button>
                            </div>
                            <div
                                id="shared-mainboard"
                                class="deck-list active"
                            ></div>
                            <div
                                id="shared-sideboard"
                                class="deck-list hidden"
                            ></div>
                        </div>

                        <!-- Stats Panel -->
                        <div class="stats-panel">
                            <h3>Deck Statistics</h3>
                            <div id="shared-deck-stats">
                                <div class="stat-section">
                                    <h4>Mana Curve</h4>
                                    <div
                                        id="shared-mana-curve"
                                        class="chart"
                                    ></div>
                                </div>
                                <div class="stat-section">
                                    <h4>Card Types</h4>
                                    <div
                                        id="shared-type-distribution"
                                        class="chart"
                                    ></div>
                                </div>
                                <div class="stat-section">
                                    <h4>Colors</h4>
                                    <div
                                        id="shared-color-distribution"
                                        class="chart"
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Set Filter Modal -->
            <div id="set-filter-modal" class="modal hidden">
                <div class="modal-content" style="max-width: 600px">
                    <span class="modal-close" id="set-filter-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1rem">Filter by Sets</h2>
                    <div class="form-group">
                        <input
                            type="text"
                            id="set-search-input"
                            placeholder="Search sets..."
                            style="
                                width: 100%;
                                padding: 0.75rem;
                                border-radius: 6px;
                                border: 1px solid var(--border-color);
                                background: var(--bg-secondary);
                            "
                        />
                    </div>
                    <div
                        id="set-list"
                        style="
                            max-height: 400px;
                            overflow-y: auto;
                            margin: 1rem 0;
                        "
                    >
                        <!-- Sets will be populated here -->
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem">
                        <button
                            id="clear-set-selection"
                            class="btn btn-secondary"
                        >
                            Clear All
                        </button>
                        <button
                            id="apply-set-filter"
                            class="btn btn-primary"
                            style="flex: 1"
                        >
                            Apply Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Subtype Filter Modal -->
            <div id="subtype-filter-modal" class="modal hidden">
                <div class="modal-content" style="max-width: 600px">
                    <span class="modal-close" id="subtype-filter-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1rem">Filter by Subtypes</h2>
                    <div class="form-group">
                        <input
                            type="text"
                            id="subtype-search-input"
                            placeholder="Search subtypes..."
                            style="
                                width: 100%;
                                padding: 0.75rem;
                                border-radius: 6px;
                                border: 1px solid var(--border-color);
                                background: var(--bg-secondary);
                            "
                        />
                    </div>
                    <div
                        id="subtype-list"
                        style="
                            max-height: 400px;
                            overflow-y: auto;
                            margin: 1rem 0;
                        "
                    >
                        <!-- Subtypes will be populated here -->
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem">
                        <button
                            id="clear-subtype-selection"
                            class="btn btn-secondary"
                        >
                            Clear All
                        </button>
                        <button
                            id="apply-subtype-filter"
                            class="btn btn-primary"
                            style="flex: 1"
                        >
                            Apply Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Legality Check Modal -->
            <div id="legality-check-modal" class="modal hidden">
                <div class="modal-content" style="max-width: 700px">
                    <span class="modal-close" id="legality-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1.5rem">Check Deck Legality</h2>
                    <div
                        id="format-selection"
                        style="
                            display: grid;
                            grid-template-columns: repeat(
                                auto-fill,
                                minmax(150px, 1fr)
                            );
                            gap: 0.75rem;
                        "
                    >
                        <!-- Format buttons will be populated here -->
                    </div>
                    <div
                        id="legality-results"
                        class="hidden"
                        style="margin-top: 2rem"
                    >
                        <!-- Results will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Printing Optimizer Modal -->
            <div id="printing-optimizer-modal" class="modal hidden">
                <div class="modal-content" style="max-width: 900px">
                    <span class="modal-close" id="optimizer-modal-close"
                        >&times;</span
                    >
                    <h2 style="margin-bottom: 1rem"><i class="ph ph-magic-wand"></i> Optimize Printings</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        Find sets with the most cards in common to create a cohesive deck with matching printings
                    </p>

                    <!-- Tabs: Auto suggestions vs Manual selection -->
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid var(--border);">
                        <button id="optimizer-tab-auto" class="tab-btn active" data-tab="auto">
                            Auto Suggestions
                        </button>
                        <button id="optimizer-tab-manual" class="tab-btn" data-tab="manual">
                            Manual Selection
                        </button>
                    </div>

                    <!-- Auto Suggestions View -->
                    <div id="optimizer-auto-view">
                        <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="exclude-commander-sets" style="width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-weight: 600;">Exclude Commander sets</span>
                            </label>
                            <p style="margin: 0.5rem 0 0 1.75rem; font-size: 0.875rem; color: var(--text-secondary);">
                                Many LGS's don't have binders for Commander sets
                            </p>
                        </div>

                        <div id="optimizer-loading" class="hidden" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <div class="spinner" style="margin: 0 auto 1rem;"></div>
                            <p>Analyzing printings...</p>
                        </div>

                        <div id="optimizer-suggestions" class="hidden">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3 style="margin: 0;">Top Set Suggestions</h3>
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    <button id="prev-suggestion-btn" class="btn-icon" title="Previous suggestion">
                                        <i class="ph ph-caret-left"></i>
                                    </button>
                                    <span id="suggestion-counter" style="font-weight: 600; min-width: 60px; text-align: center;">1 / 5</span>
                                    <button id="next-suggestion-btn" class="btn-icon" title="Next suggestion">
                                        <i class="ph ph-caret-right"></i>
                                    </button>
                                </div>
                            </div>

                            <div id="current-suggestion" style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem;">
                                <!-- Suggestion details will be populated here -->
                            </div>

                            <div id="suggestion-cards-list" style="max-height: 400px; overflow-y: auto;">
                                <!-- Cards will be populated here -->
                            </div>
                        </div>

                        <div id="optimizer-empty" class="hidden" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <i class="ph ph-cards" style="font-size: 3rem; display: block; margin-bottom: 1rem;"></i>
                            <p>No printings available for optimization.</p>
                            <p style="font-size: 0.875rem;">Add some cards to your deck first!</p>
                        </div>
                    </div>

                    <!-- Manual Selection View -->
                    <div id="optimizer-manual-view" class="hidden">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Select a Set</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="manual-set-select" style="flex: 1; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border); background: var(--bg-tertiary); color: var(--text);">
                                    <option value="">Choose a set...</option>
                                </select>
                                <button id="analyze-manual-set-btn" class="btn btn-primary">
                                    <i class="ph ph-magnifying-glass"></i> Analyze
                                </button>
                            </div>
                        </div>

                        <div id="manual-result" class="hidden">
                            <div id="manual-suggestion" style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem;">
                                <!-- Manual selection details will be populated here -->
                            </div>

                            <div id="manual-cards-list" style="max-height: 400px; overflow-y: auto;">
                                <!-- Cards will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid var(--border);">
                        <button id="apply-optimization-btn" class="btn btn-success" style="flex: 1;" disabled>
                            <i class="ph ph-check"></i> Apply Optimization
                        </button>
                        <button id="cancel-optimization-btn" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
            </div>
        </div>

        <script type="module" src="/src/main.js"></script>
    </body>
</html>
